{
  "openapi": "3.0.0",
  "info": {
    "title": "Brokerage API",
    "version": "1.0.0",
    "description": "Documentación de la API"
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Servidor local"
    }
  ],
  "paths": {
    "/api/assets/{asset}": {
      "get": {
        "summary": "Busca activos por ticker o nombre",
        "description": "Retorna un listado de activos que coinciden con el criterio de búsqueda (ticker o nombre).",
        "tags": [
          "Activos"
        ],
        "parameters": [
          {
            "in": "path",
            "name": "asset",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "El ticker o nombre del activo a buscar"
          }
        ],
        "responses": {
          "200": {
            "description": "Lista de activos similares encontrada y devuelta.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AssetsResponse"
                },
                "examples": {
                  "sample": {
                    "$ref": "#/components/examples/AssetList"
                  }
                }
              }
            }
          },
          "404": {
            "description": "Activo no encontrado o criterio de búsqueda no proporcionado.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Not found"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error interno del servidor."
          }
        }
      }
    },
    "/api/orders": {
      "post": {
        "summary": "crear una orden",
        "description": "Crea una nueva orden de compra o venta para un usuario específico.",
        "tags": [
          "Órdenes"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OrderCreateRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Orden creada exitosamente, devuelve portfolio actualizado.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PortfolioResponse"
                }
              }
            }
          },
          "400": {
            "description": "Request inválido.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "quantity debe ser un entero > 0 (acciones)."
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Activo no encontrado.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Instrumento no encontrado para ticker AAPL"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error interno del servidor."
          }
        }
      }
    },
    "/api/portfolios/{user}": {
      "get": {
        "summary": "Busca el portafolio de un usuario",
        "description": "Recupera el portafolio asociado a un usuario específico.",
        "tags": [
          "Portafolios"
        ],
        "parameters": [
          {
            "in": "path",
            "name": "user",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ID del usuario cuyo portafolio se desea recuperar."
          }
        ],
        "responses": {
          "200": {
            "description": "Portafolio recuperado exitosamente.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PortfolioResponse"
                }
              }
            }
          },
          "404": {
            "description": "Usuario no encontrado.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Not found"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error interno del servidor."
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "HeldAsset": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "ticker",
          "sharesHeld",
          "positionValue",
          "returnPercent"
        ],
        "properties": {
          "ticker": {
            "type": "string",
            "description": "Símbolo del instrumento (ej. BMA, PAMP)."
          },
          "sharesHeld": {
            "type": "integer",
            "description": "Cantidad de acciones (puede ser negativa si es short)."
          },
          "positionValue": {
            "type": "number",
            "format": "double",
            "description": "Valor monetario de la posición."
          },
          "returnPercent": {
            "type": "number",
            "format": "double",
            "description": "Rendimiento total en fracción (0.12 = 12%)."
          }
        }
      },
      "Portfolio": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "userId",
          "availableCash",
          "assetsValue",
          "totalAccountValue",
          "heldAssets"
        ],
        "properties": {
          "userId": {
            "type": "integer",
            "description": "ID del usuario."
          },
          "availableCash": {
            "type": "number",
            "format": "double",
            "description": "Efectivo disponible para operar."
          },
          "assetsValue": {
            "type": "number",
            "format": "double",
            "description": "Valor total de las posiciones."
          },
          "totalAccountValue": {
            "type": "number",
            "format": "double",
            "description": "Efectivo + valor de posiciones."
          },
          "heldAssets": {
            "type": "array",
            "description": "Detalle de activos en cartera.",
            "items": {
              "$ref": "#/components/schemas/HeldAsset"
            }
          }
        }
      },
      "PortfolioResponse": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "data"
        ],
        "properties": {
          "data": {
            "$ref": "#/components/schemas/Portfolio"
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "error"
        ],
        "properties": {
          "error": {
            "type": "string"
          }
        }
      },
      "OrderCreateRequest": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "ticker",
          "user",
          "quantity",
          "side",
          "orderType"
        ],
        "properties": {
          "ticker": {
            "type": "string",
            "description": "Símbolo del instrumento."
          },
          "user": {
            "type": "integer",
            "description": "ID del usuario."
          },
          "quantity": {
            "type": "integer",
            "minimum": 1,
            "description": "Cantidad de acciones."
          },
          "side": {
            "type": "string",
            "enum": [
              "BUY",
              "SELL"
            ],
            "description": "Lado de la orden."
          },
          "orderType": {
            "type": "string",
            "enum": [
              "MARKET",
              "LIMIT"
            ],
            "description": "Tipo de orden."
          },
          "price": {
            "type": "number",
            "description": "Precio límite (requerido si orderType=LIMIT)."
          }
        }
      },
      "Asset": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "ticker",
          "name",
          "currentPrice"
        ],
        "properties": {
          "ticker": {
            "type": "string",
            "description": "Símbolo del instrumento (ej. PAMP)."
          },
          "name": {
            "type": "string",
            "description": "Nombre del instrumento."
          },
          "currentPrice": {
            "type": "string",
            "description": "Precio actual como string decimal (ej. \"925.85\")."
          }
        }
      },
      "AssetsResponse": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "data"
        ],
        "properties": {
          "data": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Asset"
            }
          }
        }
      }
    },
    "examples": {
      "AssetList": {
        "summary": "Lista con un activo",
        "value": {
          "data": [
            {
              "ticker": "PAMP",
              "name": "Pampa Holding S.A.",
              "currentPrice": "925.85"
            }
          ]
        }
      }
    }
  },
  "tags": []
}